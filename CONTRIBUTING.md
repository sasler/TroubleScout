# Contributing to TroubleScout

Thank you for your interest in contributing to TroubleScout! This document provides guidelines and information to help you contribute effectively.

## ğŸ”’ Branch Protection Policy

The `main` branch is protected to maintain code quality and stability. All changes must go through a pull request process.

### Protected Branch Rules

The following protections are enforced on the `main` branch:

1. **No Direct Commits**: All changes must be made through pull requests
2. **Required Reviews**: Pull requests require at least one approval from a code owner
3. **Required Status Checks**: The following checks must pass before merging:
   - âœ… Build and Test workflow
   - âœ… Tests workflow (Windows and Ubuntu)
   - âœ… Branch Protection validation workflow
4. **Branch Must Be Up-to-Date**: PRs must be updated with the latest main branch before merging
5. **Signed Commits**: Commits should be signed when possible (recommended)

### Branch Naming Convention

Branch names must follow this pattern:

```
{type}/{description}
```

**Valid types:**
- `feature/` - New features or enhancements
- `fix/` - Bug fixes
- `hotfix/` - Critical production fixes
- `docs/` - Documentation changes
- `test/` - Test additions or modifications
- `refactor/` - Code refactoring
- `perf/` - Performance improvements
- `ci/` - CI/CD changes
- `build/` - Build system changes
- `chore/` - Maintenance tasks

**Examples:**
- `feature/add-disk-diagnostics`
- `fix/memory-leak-in-session`
- `docs/update-installation-guide`

### Commit Message Format

All commit messages must follow one of these formats:

**Option 1: Emoji Prefix (Preferred)**
```
{emoji} {Summary of changes}

Example: âœ¨ Add WinRM connectivity check
```

**Option 2: Conventional Commits**
```
{type}({scope}): {summary}

Example: feat(diagnostics): add WinRM connectivity check
```

**Option 3: Simple Plan Commits** (for workflow tracking)
```
Initial plan
WIP
Work in progress
Checkpoint

Note: These are allowed for initial planning commits but should be avoided in final PRs.
```

**Option 4: Automated Updates** (for bots and automated tools)
```
Update {filename}
Update {description}

Example: Update README.md
Example: Update dependencies

Note: These are typically generated by bots or automated tools (e.g., Dependabot, Copilot).
```

**Common Emojis:**
- âœ¨ `:sparkles:` - New features
- ğŸ› `:bug:` - Bug fixes
- ğŸ“ `:memo:` - Documentation
- â™»ï¸ `:recycle:` - Refactoring
- âš¡ï¸ `:zap:` - Performance improvements
- ğŸ”’ `:lock:` - Security fixes
- âœ… `:white_check_mark:` - Tests
- ğŸ”§ `:wrench:` - Configuration
- ğŸš€ `:rocket:` - Deployment/releases
- ğŸ”– `:bookmark:` - Version tags

## ğŸ“‹ Pull Request Process

### Before Opening a PR

1. **Create a branch** following the naming convention
2. **Make your changes** with clear, focused commits
3. **Test locally**:
   ```bash
   dotnet build
   dotnet test
   ```
4. **Ensure code quality**:
   - Follow existing code style
   - Add tests for new features
   - Update documentation as needed

### Opening a PR

1. **Title**: Must start with an emoji or conventional commit type
   - Example: `âœ¨ Add network diagnostics tool`
   - Example: `feat: add network diagnostics tool`

2. **Description**: Include:
   - What changes were made
   - Why the changes were needed
   - How to test the changes
   - Any breaking changes or migration notes

3. **Link Issues**: Reference any related issues with `Closes #123` or `Fixes #123`

### PR Review Process

1. **Automated Checks**: Wait for all CI checks to pass
2. **Code Review**: A code owner will review your changes
3. **Address Feedback**: Make requested changes and push new commits
4. **Approval**: Once approved and all checks pass, a maintainer will merge

### After Merge

- Your branch will be automatically deleted
- Changes will be included in the next release

## ğŸš€ Release Process

Releases are automated via GitHub Actions. When a version tag is pushed, the release workflow automatically:

1. Builds a self-contained Windows x64 executable
2. Packages TroubleScout.exe + runtimes/ folder into a zip
3. Creates a GitHub release with release notes

**Only maintainers can create releases.** See [RELEASE-PROCESS.md](RELEASE-PROCESS.md) for detailed instructions.

## ğŸ§ª Testing Guidelines

### Running Tests

```bash
# Run all tests
dotnet test

# Run tests with detailed output
dotnet test --verbosity normal

# Run tests for specific project
dotnet test TroubleScout.Tests/TroubleScout.Tests.csproj
```

### Writing Tests

- Place tests in the `TroubleScout.Tests` project
- Follow existing test patterns
- Use descriptive test names: `MethodName_Scenario_ExpectedBehavior`
- Include both positive and negative test cases

## ğŸ—ï¸ Development Setup

### Prerequisites

1. **.NET 10.0 SDK** - [Download](https://dotnet.microsoft.com/download/dotnet/10.0)
2. **Node.js** - Required for Copilot CLI - [Download](https://nodejs.org/)
3. **GitHub Copilot SDK CLI**:
   ```bash
   npm install -g @github/copilot-sdk
   ```
4. **GitHub Copilot Access** - Active subscription required

### Building from Source

```bash
# Clone the repository
git clone https://github.com/sasler/TroubleScout.git
cd TroubleScout

# Restore dependencies
dotnet restore

# Build the project
dotnet build

# Run the application
dotnet run -- --server localhost
```

### Project Structure

```
TroubleScout/
â”œâ”€â”€ Program.cs                  # CLI entry point
â”œâ”€â”€ TroubleshootingSession.cs   # Copilot SDK integration
â”œâ”€â”€ Services/                   # Infrastructure services
â”‚   â”œâ”€â”€ PowerShellExecutor.cs   # Command execution
â”‚   â””â”€â”€ WinRMConnection.cs      # Remote connectivity
â”œâ”€â”€ Tools/                      # AI tool functions
â”‚   â””â”€â”€ DiagnosticTools.cs      # Diagnostic capabilities
â”œâ”€â”€ UI/                         # User interface
â”‚   â””â”€â”€ ConsoleUI.cs            # Spectre.Console TUI
â””â”€â”€ TroubleScout.Tests/         # Unit tests
```

## ğŸ“ Code Style Guidelines

### General Principles

- Follow [C# Coding Conventions](https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/coding-style/coding-conventions)
- Use meaningful variable and method names
- Keep methods focused and small
- Add XML documentation comments for public APIs
- Handle exceptions appropriately

### PowerShell Integration

- Always validate commands before execution
- Use the safety model (Get-* auto-execute, others require approval)
- Test commands on localhost before remote execution

### Copilot SDK Usage

- Use event-based streaming with `CopilotSession.On()`
- Subscribe to `AssistantMessageDeltaEvent` for streaming
- Wait for `SessionIdleEvent` to detect completion
- Never use async iterators (not supported by SDK)

## ğŸ› Reporting Issues

### Bug Reports

Include:
- TroubleScout version
- Operating system and version
- .NET version (`dotnet --version`)
- Steps to reproduce
- Expected vs actual behavior
- Error messages or logs

### Feature Requests

Include:
- Use case description
- Why this feature is needed
- How it should work
- Any examples or mockups

## ğŸ” Security

- **Do not commit secrets** or credentials
- **Report security vulnerabilities** privately to the maintainers
- **Follow the security model** when adding new diagnostic tools
- **Validate user input** to prevent command injection

## ğŸ“„ License

By contributing, you agree that your contributions will be licensed under the MIT License.

## ğŸ’¬ Questions?

- Open a [GitHub Discussion](https://github.com/sasler/TroubleScout/discussions)
- Review existing [Issues](https://github.com/sasler/TroubleScout/issues)
- Check the [README](README.md) for documentation

## ğŸ™ Thank You!

Your contributions help make TroubleScout better for everyone. We appreciate your time and effort!
